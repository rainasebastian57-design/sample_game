<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cyberpunk Maze</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<style>
body {
    margin: 0;
    height: 100vh;
    background: radial-gradient(circle at center, #050014, #000);
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'Orbitron', monospace;
    overflow: hidden;
}

#game {
    display: grid;
    grid-template-columns: repeat(15, 42px);
    grid-auto-rows: 42px;
    gap: 4px;
    padding: 20px;
    border: 2px solid #00f6ff;
    box-shadow: 0 0 25px #00f6ff;
    background: rgba(0,0,0,0.6);
}

.wall {
    background: #0b0b14;
    box-shadow: inset 0 0 10px #ff0055;
}

.path {
    background: transparent;
}

.player {
    background: linear-gradient(135deg, #00f6ff, #0066ff);
    box-shadow: 0 0 20px #00f6ff;
    animation: pulse 1.2s infinite;
}

.exit {
    background: linear-gradient(135deg, #ffe600, #ff9900);
    box-shadow: 0 0 25px #ffe600;
    animation: glow 1.5s infinite;
}

@keyframes pulse {
    0% { box-shadow: 0 0 10px #00f6ff; }
    50% { box-shadow: 0 0 25px #00f6ff; }
    100% { box-shadow: 0 0 10px #00f6ff; }
}

@keyframes glow {
    0% { box-shadow: 0 0 12px #ffe600; }
    50% { box-shadow: 0 0 30px #ffe600; }
    100% { box-shadow: 0 0 12px #ffe600; }
}

#winScreen {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.92);
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    color: #00f6ff;
    font-size: 56px;
    text-shadow: 0 0 25px #00f6ff;
    z-index: 10;
}

#winScreen span {
    font-size: 18px;
    margin-top: 15px;
    color: #ffe600;
}
</style>
</head>

<body>

<div id="game"></div>

<div id="winScreen">
    YOU WIN
    <span>System Breached</span>
</div>

<!-- Auto-generated by Emscripten -->
<script src="maze.js"></script>

<script>
let getMaze, movePlayer, hasWon;

Module.onRuntimeInitialized = () => {
    getMaze = Module.cwrap("getMaze", "string", []);
    movePlayer = Module.cwrap("movePlayer", null, ["number"]);
    hasWon = Module.cwrap("hasWon", "number", []);
    render();
};

function render() {
    const mazeData = getMaze().trim().split("\n");
    const game = document.getElementById("game");
    game.innerHTML = "";

    mazeData.forEach(row => {
        [...row].forEach(cell => {
            const tile = document.createElement("div");

            if (cell === "#") tile.className = "wall";
            else if (cell === "P") tile.className = "player";
            else if (cell === "E") tile.className = "exit";
            else tile.className = "path";

            game.appendChild(tile);
        });
    });

    if (hasWon()) {
        document.getElementById("winScreen").style.display = "flex";
    }
}

document.addEventListener("keydown", e => {
    let dir = null;

    if (e.key === "ArrowUp") dir = 'w'.charCodeAt(0);
    else if (e.key === "ArrowDown") dir = 's'.charCodeAt(0);
    else if (e.key === "ArrowLeft") dir = 'a'.charCodeAt(0);
    else if (e.key === "ArrowRight") dir = 'd'.charCodeAt(0);

    if (dir !== null) {
        movePlayer(dir);
        render();
        e.preventDefault();
    }
});
</script>

</body>
</html>

